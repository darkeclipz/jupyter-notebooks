
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass[11pt]{article}

    
    
    \usepackage[T1]{fontenc}
    % Nicer default font (+ math font) than Computer Modern for most use cases
    \usepackage{mathpazo}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % We will generate all images so they have a width \maxwidth. This means
    % that they will get their normal width if they fit onto the page, but
    % are scaled down if they would overflow the margins.
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
    \else\Gin@nat@width\fi}
    \makeatother
    \let\Oldincludegraphics\includegraphics
    % Set max figure width to be 80% of text width, for now hardcoded.
    \renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=.8\maxwidth]{#1}}
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionLabelFormat{nolabel}{}
    \captionsetup{labelformat=nolabel}

    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    

    
    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{Multi Exponential Moving Average Strategy with Fibonacci Retrace Order Filling}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@fm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sa\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@dl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    Throughout this document the following imports and styles are used.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}1}]:} \PY{o}{\PYZpc{}}\PY{k}{pylab} inline
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Populating the interactive namespace from numpy and matplotlib

    \end{Verbatim}

    \hypertarget{goal}{%
\section{Goal}\label{goal}}

    In this document we will be testing a multiple exponential moving
average crossover strategy. We will also create an entry position
calculated with a Fibonacci between the point of the crossover and the
low/high of the candle.

    \hypertarget{issues-with-our-model}{%
\subsection{Issues with our model}\label{issues-with-our-model}}

    This model still has a few unsolved issues:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  We have created a target price for which the older should be opened.
  It is however opened on the close price for the candle where the
  target price is hit with the high or low. The assumption is that it
  gives minimal effect.
\item
  Short position P/L is perhaps not calculated correctly.
\end{enumerate}

    \hypertarget{imports}{%
\section{Imports}\label{imports}}

    \hypertarget{general-libraries}{%
\subsection{General libraries}\label{general-libraries}}

    These are the general Python libraries that are used.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{k+kn}{from} \PY{n+nn}{datetime} \PY{k}{import} \PY{n}{datetime}\PY{p}{,} \PY{n}{timedelta}
        \PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
        \PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k}{as} \PY{n+nn}{pd}
\end{Verbatim}


    \hypertarget{custom-libraries}{%
\subsection{Custom libraries}\label{custom-libraries}}

    These are the custom libraries that hold the framework to perform and
analyze a backtest.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}3}]:} \PY{k+kn}{import} \PY{n+nn}{poloniex} \PY{k}{as} \PY{n+nn}{plnx}
        \PY{k+kn}{import} \PY{n+nn}{ta\PYZus{}lib} \PY{k}{as} \PY{n+nn}{ta}
        \PY{k+kn}{import} \PY{n+nn}{signals} \PY{k}{as} \PY{n+nn}{sg}
        \PY{k+kn}{import} \PY{n+nn}{backtest} \PY{k}{as} \PY{n+nn}{bt}
\end{Verbatim}


    \hypertarget{technical-analysis-for-trading-signals}{%
\section{Technical Analysis for Trading
Signals}\label{technical-analysis-for-trading-signals}}

    To run a backtest trading simulation we will need to set it up with
parameters. The parameters will be explained per section.

    \hypertarget{chart-data}{%
\subsection{Chart data}\label{chart-data}}

    We are using data from http://www.poloniex.com API. Our test is done on
the \texttt{USDT\_BTC} pair..

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}4}]:} \PY{n}{pair} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{USDT\PYZus{}BTC}\PY{l+s+s1}{\PYZsq{}}
        \PY{n}{timeframe} \PY{o}{=} \PY{l+m+mi}{30} \PY{o}{*} \PY{l+m+mi}{60}
        \PY{n}{end} \PY{o}{=} \PY{n}{datetime}\PY{o}{.}\PY{n}{utcnow}\PY{p}{(}\PY{p}{)}
        \PY{n}{start} \PY{o}{=} \PY{n}{end} \PY{o}{\PYZhy{}} \PY{n}{timedelta}\PY{p}{(}\PY{n}{days}\PY{o}{=}\PY{l+m+mi}{365}\PY{o}{*}\PY{l+m+mi}{3}\PY{p}{)}
        \PY{n}{chart} \PY{o}{=} \PY{n}{plnx}\PY{o}{.}\PY{n}{get\PYZus{}chart}\PY{p}{(}\PY{n}{pair}\PY{p}{,} \PY{n}{timeframe}\PY{p}{,} \PY{n}{start}\PY{p}{,} \PY{n}{end}\PY{p}{)}
\end{Verbatim}


    \hypertarget{technical-indicators}{%
\subsection{Technical Indicators}\label{technical-indicators}}

    We will be using the following technical indicators to generate signals:

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}5}]:} \PY{n}{ta}\PY{o}{.}\PY{n}{ema}\PY{p}{(}\PY{n}{chart}\PY{p}{,} \PY{l+m+mi}{8}\PY{p}{)}
        \PY{n}{ta}\PY{o}{.}\PY{n}{ema}\PY{p}{(}\PY{n}{chart}\PY{p}{,} \PY{l+m+mi}{13}\PY{p}{)}
        \PY{n}{ta}\PY{o}{.}\PY{n}{ema}\PY{p}{(}\PY{n}{chart}\PY{p}{,} \PY{l+m+mi}{21}\PY{p}{)}
        \PY{n}{ta}\PY{o}{.}\PY{n}{ema}\PY{p}{(}\PY{n}{chart}\PY{p}{,} \PY{l+m+mi}{55}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}6}]:} \PY{n}{chart}\PY{p}{[}\PY{l+m+mi}{50}\PY{p}{:}\PY{l+m+mi}{60}\PY{p}{]}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}6}]:}          close                 date        high         low        open  \textbackslash{}
        50  232.506980  2015-05-21 16:00:00  232.506980  232.506980  232.506980   
        51  232.506980  2015-05-21 16:30:00  232.506980  232.506980  232.506980   
        52  232.506980  2015-05-21 17:00:00  232.506980  232.506980  232.506980   
        53  232.506980  2015-05-21 17:30:00  232.506980  232.506980  232.506980   
        54  230.840005  2015-05-21 18:00:00  230.840005  230.840005  230.840005   
        55  230.840005  2015-05-21 18:30:00  230.840005  230.840005  230.840005   
        56  230.840005  2015-05-21 19:00:00  230.840005  230.840005  230.840005   
        57  230.840005  2015-05-21 19:30:00  230.840005  230.840005  230.840005   
        58  232.506980  2015-05-21 20:00:00  232.506980  232.506980  232.506980   
        59  232.506980  2015-05-21 20:30:00  232.506980  232.506980  232.506980   
        
                  ema8       ema13       ema21       ema55  
        50  232.361509  232.115389  232.170177         NaN  
        51  232.444565  232.175505  232.193722         NaN  
        52  232.506980  232.226392  232.215027         NaN  
        53  232.506980  232.302578  232.234304         NaN  
        54  232.045796  232.078046  232.070977  232.819881  
        55  231.699226  231.887984  231.923192  232.741568  
        56  231.438787  231.727101  231.789471  232.666103  
        57  231.243073  231.590915  231.677024  232.593382  
        58  231.557183  231.731548  231.756005  232.593005  
        59  231.793229  231.850591  231.827469  232.592641  
\end{Verbatim}
            
    \hypertarget{signals}{%
\subsection{Signals}\label{signals}}

    We will be using multiple EMA's to generate crossover signals.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}7}]:} \PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{open\PYZus{}long}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{open\PYZus{}short}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{close\PYZus{}long}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{close\PYZus{}short}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{0}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}8}]:} \PY{k}{def} \PY{n+nf}{getFib}\PY{p}{(}\PY{n}{crossover\PYZus{}price}\PY{p}{,} \PY{n}{candle\PYZus{}high\PYZus{}low}\PY{p}{,} \PY{n}{lvl}\PY{p}{)}\PY{p}{:} \PY{k}{return} \PY{n}{crossover\PYZus{}price}\PY{o}{\PYZhy{}}\PY{p}{(}\PY{n}{crossover\PYZus{}price}\PY{o}{\PYZhy{}}\PY{n}{candle\PYZus{}high\PYZus{}low}\PY{p}{)}\PY{o}{*}\PY{n}{lvl}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}9}]:} \PY{n}{head} \PY{o}{=} \PY{l+m+mi}{56}
        \PY{n}{ema1} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ema8}\PY{l+s+s1}{\PYZsq{}}
        \PY{n}{ema2} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ema13}\PY{l+s+s1}{\PYZsq{}}
        \PY{n}{ema3} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ema21}\PY{l+s+s1}{\PYZsq{}}
        \PY{n}{ema4} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ema55}\PY{l+s+s1}{\PYZsq{}}
        
        \PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{crossover}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{target\PYZus{}price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{target\PYZus{}low}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{dbg\PYZus{}long}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{dbg\PYZus{}short}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{0}
        \PY{n}{state} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{none}\PY{l+s+s1}{\PYZsq{}}
        \PY{n}{order\PYZus{}filled} \PY{o}{=} \PY{k+kc}{False}
        
        \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{head}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{chart}\PY{o}{.}\PY{n}{index}\PY{p}{)}\PY{p}{)}\PY{p}{:}
            \PY{n}{p1} \PY{o}{=} \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{ema1}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{ema4}\PY{p}{]}
            \PY{n}{p2} \PY{o}{=} \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{ema2}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{ema4}\PY{p}{]}
            \PY{n}{p3} \PY{o}{=} \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{ema3}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{ema4}\PY{p}{]}
            \PY{k}{if}\PY{p}{(}\PY{n}{p1} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0} \PY{o+ow}{and} \PY{n}{p2} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0} \PY{o+ow}{and} \PY{n}{p3} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{:} \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{crossover}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{1}
            \PY{k}{if}\PY{p}{(}\PY{n}{p2} \PY{o}{\PYZlt{}} \PY{l+m+mi}{0} \PY{o+ow}{and} \PY{n}{p2} \PY{o}{\PYZlt{}} \PY{l+m+mi}{0} \PY{o+ow}{and} \PY{n}{p3} \PY{o}{\PYZlt{}} \PY{l+m+mi}{0}\PY{p}{)}\PY{p}{:} \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{crossover}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}
            \PY{n}{prev} \PY{o}{=} \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{crossover}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
            \PY{n}{current} \PY{o}{=} \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{crossover}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
            
            \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{target\PYZus{}price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{target\PYZus{}price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
            
            \PY{k}{if} \PY{p}{(}\PY{n}{prev} \PY{o}{==} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1} \PY{o+ow}{or} \PY{n}{prev} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{)} \PY{o+ow}{and} \PY{n}{current} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{:} 
                \PY{k}{if} \PY{n}{state} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{short}\PY{l+s+s1}{\PYZsq{}} \PY{o+ow}{and} \PY{n}{order\PYZus{}filled}\PY{p}{:}
                    \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{close\PYZus{}short}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{1}
                \PY{n}{state} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{long}\PY{l+s+s1}{\PYZsq{}}
                \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{target\PYZus{}price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{getFib}\PY{p}{(}\PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{ema4}\PY{p}{]}\PY{p}{,} \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{low}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{o}{.}\PY{l+m+mi}{702}\PY{p}{)}
                \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{dbg\PYZus{}long}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{1}
                \PY{n}{order\PYZus{}filled} \PY{o}{=} \PY{k+kc}{False}
                
            \PY{k}{if} \PY{p}{(}\PY{n}{prev} \PY{o}{==} \PY{l+m+mi}{1} \PY{o+ow}{or} \PY{n}{prev} \PY{o}{==} \PY{l+m+mi}{0}\PY{p}{)} \PY{o+ow}{and} \PY{n}{current} \PY{o}{==} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{:} 
                \PY{k}{if} \PY{n}{state} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{long}\PY{l+s+s1}{\PYZsq{}} \PY{o+ow}{and} \PY{n}{order\PYZus{}filled}\PY{p}{:}
                    \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{close\PYZus{}long}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{1}
                \PY{n}{state} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{short}\PY{l+s+s1}{\PYZsq{}}
                \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{target\PYZus{}price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{getFib}\PY{p}{(}\PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{n}{ema4}\PY{p}{]}\PY{p}{,} \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{high}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{o}{.}\PY{l+m+mi}{702}\PY{p}{)}
                \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{dbg\PYZus{}short}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{1}
                \PY{n}{order\PYZus{}filled} \PY{o}{=} \PY{k+kc}{False}
                 
            \PY{k}{if} \PY{n}{state} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{long}\PY{l+s+s1}{\PYZsq{}} \PY{o+ow}{and} \PY{o+ow}{not} \PY{n}{order\PYZus{}filled}\PY{p}{:}
                \PY{k}{if} \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{target\PYZus{}price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{low}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{:}
                    \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{open\PYZus{}long}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{1}
                    \PY{n}{order\PYZus{}filled} \PY{o}{=} \PY{k+kc}{True}
        
            \PY{k}{if} \PY{n}{state} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{short}\PY{l+s+s1}{\PYZsq{}} \PY{o+ow}{and} \PY{o+ow}{not} \PY{n}{order\PYZus{}filled}\PY{p}{:}
                \PY{k}{if} \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{target\PYZus{}price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZlt{}} \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{high}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{:}
                    \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{open\PYZus{}short}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{1}
                    \PY{n}{order\PYZus{}filled} \PY{o}{=} \PY{k+kc}{True}
\end{Verbatim}


    \hypertarget{plotting-strategy-indicators}{%
\subsection{Plotting strategy
indicators}\label{plotting-strategy-indicators}}

    If we plot all our technical indicators in a chart.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}10}]:} \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{p}{(}\PY{l+m+mi}{120}\PY{p}{,}\PY{l+m+mi}{12}\PY{p}{)}\PY{p}{)}
         \PY{n}{plot}\PY{p}{(}\PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{high}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{c}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lime}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{lw}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{plot}\PY{p}{(}\PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{low}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{c}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{red}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{lw}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
         \PY{n}{plot}\PY{p}{(}\PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ema55}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{c}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{magenta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plot}\PY{p}{(}\PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{target\PYZus{}price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{target\PYZus{}price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{c}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{b}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ls}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{dashed}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{dbg\PYZus{}long} \PY{o}{=} \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{dbg\PYZus{}long}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{]}
         \PY{n}{dbg\PYZus{}short} \PY{o}{=} \PY{n}{chart}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{dbg\PYZus{}short}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{]}
         \PY{n}{scatter}\PY{p}{(}\PY{n}{dbg\PYZus{}long}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{dbg\PYZus{}long}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{c}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lime}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{lw}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{,} \PY{n}{marker}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{)}
         \PY{n}{scatter}\PY{p}{(}\PY{n}{dbg\PYZus{}short}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{dbg\PYZus{}short}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{c}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{red}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{lw}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{,} \PY{n}{marker}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{x}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.5}\PY{p}{)}
         \PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{High}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Low}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{EMA55}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Target price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Long}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Short}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{grid}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_29_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{close-and-ema55-distance-indicator}{%
\subsubsection{Close and EMA55 distance
indicator}\label{close-and-ema55-distance-indicator}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}11}]:} \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{,}\PY{l+m+mi}{6}\PY{p}{)}\PY{p}{)}
         \PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{dist}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ema55}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{plot}\PY{p}{(}\PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{dist}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{fill\PYZus{}between}\PY{p}{(}\PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{chart}\PY{o}{.}\PY{n}{index}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{dist}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.25}\PY{p}{)}
         \PY{n}{axhline}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{n}{c}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{black}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{grid}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_31_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{ema-crossover-indicator}{%
\subsubsection{EMA crossover indicator}\label{ema-crossover-indicator}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}12}]:} \PY{n}{plot}\PY{p}{(}\PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{crossover}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
         \PY{n}{fill\PYZus{}between}\PY{p}{(}\PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{chart}\PY{o}{.}\PY{n}{index}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{crossover}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.25}\PY{p}{)}
         \PY{n}{axhline}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,} \PY{n}{ls}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{dashed}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{c}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{black}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{grid}\PY{p}{(}\PY{p}{)}\PY{p}{;}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_33_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{signal-indicator}{%
\subsubsection{Signal indicator}\label{signal-indicator}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}13}]:} \PY{n}{plt}\PY{o}{.}\PY{n}{step}\PY{p}{(}\PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{chart}\PY{o}{.}\PY{n}{index}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{open\PYZus{}long}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{c}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lime}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{step}\PY{p}{(}\PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{chart}\PY{o}{.}\PY{n}{index}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{open\PYZus{}short}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{c}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{step}\PY{p}{(}\PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{chart}\PY{o}{.}\PY{n}{index}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{close\PYZus{}long}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{c}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lime}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{dashed}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{step}\PY{p}{(}\PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{chart}\PY{o}{.}\PY{n}{index}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{chart}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{close\PYZus{}short}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,}\PY{n}{c}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linestyle}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{dashed}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{step}\PY{p}{(}\PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{chart}\PY{o}{.}\PY{n}{index}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{zeros}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{chart}\PY{o}{.}\PY{n}{index}\PY{p}{)}\PY{p}{)}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{t}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Signal On/Off}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Signals}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}\PY{p}{;}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_35_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{optimal-stop-loss-percentage}{%
\subsection{Optimal stop loss
percentage}\label{optimal-stop-loss-percentage}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}14}]:} \PY{n}{use\PYZus{}leverage} \PY{o}{=} \PY{l+m+mi}{1}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}15}]:} \PY{n}{results} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
         \PY{k}{for} \PY{n}{slp} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{11}\PY{p}{)}\PY{p}{:} \PY{c+c1}{\PYZsh{} 11}
             \PY{n}{slp} \PY{o}{/}\PY{o}{=} \PY{l+m+mi}{100}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Simulating for }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{slp}\PY{p}{)}\PY{p}{)}
             \PY{n}{sim} \PY{o}{=} \PY{n}{bt}\PY{o}{.}\PY{n}{TradingSim}\PY{p}{(}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{chart}\PY{p}{)}\PY{p}{)}
             \PY{n}{sim}\PY{o}{.}\PY{n}{balance} \PY{o}{=} \PY{l+m+mi}{1000}
             \PY{n}{sim}\PY{o}{.}\PY{n}{lot\PYZus{}size} \PY{o}{=} \PY{l+m+mf}{0.1}
             \PY{n}{sim}\PY{o}{.}\PY{n}{fee\PYZus{}percentage} \PY{o}{=} \PY{l+m+mf}{0.00050}
             \PY{n}{sim}\PY{o}{.}\PY{n}{leverage} \PY{o}{=} \PY{n}{use\PYZus{}leverage}
             \PY{n}{sim}\PY{o}{.}\PY{n}{stop\PYZus{}loss\PYZus{}type} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{limit}\PY{l+s+s1}{\PYZsq{}}
             \PY{n}{sim}\PY{o}{.}\PY{n}{stop\PYZus{}loss\PYZus{}percentage} \PY{o}{=} \PY{n}{slp}
             \PY{n}{sim}\PY{o}{.}\PY{n}{run}\PY{p}{(}\PY{p}{)}    
             \PY{n}{results}\PY{p}{[}\PY{n}{slp}\PY{p}{]} \PY{o}{=} \PY{n}{sim}\PY{o}{.}\PY{n}{balance}
             
         \PY{n}{x}\PY{p}{,}\PY{n}{y} \PY{o}{=} \PY{n+nb}{list}\PY{p}{(}\PY{n}{results}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n+nb}{list}\PY{p}{(}\PY{n}{results}\PY{o}{.}\PY{n}{values}\PY{p}{(}\PY{p}{)}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
         \PY{n}{plot}\PY{p}{(}\PY{n}{x}\PY{p}{,}\PY{n}{y}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
         \PY{n}{optimal\PYZus{}stop\PYZus{}loss\PYZus{}percentage} \PY{o}{=} \PY{n}{x}\PY{p}{[}\PY{n}{y}\PY{o}{.}\PY{n}{index}\PY{p}{(}\PY{n+nb}{max}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{)}\PY{p}{]}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Optimal solution at: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{optimal\PYZus{}stop\PYZus{}loss\PYZus{}percentage}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Simulating for 0.01
Simulating for 0.02
Simulating for 0.03
Simulating for 0.04
Simulating for 0.05
Simulating for 0.06
Simulating for 0.07
Simulating for 0.08
Simulating for 0.09
Simulating for 0.1

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_38_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
Optimal solution at: 0.08

    \end{Verbatim}

    \hypertarget{optimal-lot-size}{%
\subsection{Optimal lot size}\label{optimal-lot-size}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}16}]:} \PY{n}{results} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
         \PY{k}{for} \PY{n}{ls} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{11}\PY{p}{)}\PY{p}{:} \PY{c+c1}{\PYZsh{} 11}
             \PY{n}{ls} \PY{o}{/}\PY{o}{=} \PY{l+m+mi}{10}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Simulating for }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{ls}\PY{p}{)}\PY{p}{)}
             \PY{n}{sim} \PY{o}{=} \PY{n}{bt}\PY{o}{.}\PY{n}{TradingSim}\PY{p}{(}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{chart}\PY{p}{)}\PY{p}{)}
             \PY{n}{sim}\PY{o}{.}\PY{n}{balance} \PY{o}{=} \PY{l+m+mi}{1000}
             \PY{n}{sim}\PY{o}{.}\PY{n}{lot\PYZus{}size} \PY{o}{=} \PY{n}{ls}
             \PY{n}{sim}\PY{o}{.}\PY{n}{fee\PYZus{}percentage} \PY{o}{=} \PY{l+m+mf}{0.00050}
             \PY{n}{sim}\PY{o}{.}\PY{n}{leverage} \PY{o}{=} \PY{n}{use\PYZus{}leverage}
             \PY{n}{sim}\PY{o}{.}\PY{n}{stop\PYZus{}loss\PYZus{}type} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{limit}\PY{l+s+s1}{\PYZsq{}}
             \PY{n}{sim}\PY{o}{.}\PY{n}{stop\PYZus{}loss\PYZus{}percentage} \PY{o}{=} \PY{n}{optimal\PYZus{}stop\PYZus{}loss\PYZus{}percentage}
             \PY{n}{sim}\PY{o}{.}\PY{n}{run}\PY{p}{(}\PY{p}{)}    
             \PY{n}{results}\PY{p}{[}\PY{n}{ls}\PY{p}{]} \PY{o}{=} \PY{n}{sim}\PY{o}{.}\PY{n}{balance}
             
         \PY{n}{x}\PY{p}{,}\PY{n}{y} \PY{o}{=} \PY{n+nb}{list}\PY{p}{(}\PY{n}{results}\PY{o}{.}\PY{n}{keys}\PY{p}{(}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n+nb}{list}\PY{p}{(}\PY{n}{results}\PY{o}{.}\PY{n}{values}\PY{p}{(}\PY{p}{)}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
         \PY{n}{plot}\PY{p}{(}\PY{n}{x}\PY{p}{,}\PY{n}{y}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
         \PY{n}{optimal\PYZus{}lot\PYZus{}size} \PY{o}{=} \PY{n}{x}\PY{p}{[}\PY{n}{y}\PY{o}{.}\PY{n}{index}\PY{p}{(}\PY{n+nb}{max}\PY{p}{(}\PY{n}{y}\PY{p}{)}\PY{p}{)}\PY{p}{]}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Optimal solution at: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{optimal\PYZus{}lot\PYZus{}size}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Simulating for 0.1
Simulating for 0.2
Simulating for 0.3
Simulating for 0.4
Simulating for 0.5
Simulating for 0.6
Simulating for 0.7
Simulating for 0.8
Simulating for 0.9
Simulating for 1.0

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_40_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
Optimal solution at: 0.3

    \end{Verbatim}

    \hypertarget{simulation}{%
\section{Simulation}\label{simulation}}

    We will start with \(\$1000\) and use the following parameters:

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}17}]:} \PY{n}{sim} \PY{o}{=} \PY{n}{bt}\PY{o}{.}\PY{n}{TradingSim}\PY{p}{(}\PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{chart}\PY{p}{)}\PY{p}{)}
         \PY{n}{sim}\PY{o}{.}\PY{n}{balance} \PY{o}{=} \PY{l+m+mi}{1000}
         \PY{n}{sim}\PY{o}{.}\PY{n}{lot\PYZus{}size} \PY{o}{=} \PY{n}{optimal\PYZus{}lot\PYZus{}size}
         \PY{n}{sim}\PY{o}{.}\PY{n}{fee\PYZus{}percentage} \PY{o}{=} \PY{l+m+mf}{0.00050}
         \PY{n}{sim}\PY{o}{.}\PY{n}{leverage} \PY{o}{=} \PY{n}{use\PYZus{}leverage}
         \PY{n}{sim}\PY{o}{.}\PY{n}{stop\PYZus{}loss\PYZus{}type} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{limit}\PY{l+s+s1}{\PYZsq{}}
         \PY{n}{sim}\PY{o}{.}\PY{n}{stop\PYZus{}loss\PYZus{}percentage} \PY{o}{=} \PY{n}{optimal\PYZus{}stop\PYZus{}loss\PYZus{}percentage}
         \PY{n}{sim}\PY{o}{.}\PY{n}{run}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}18}]:} \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Final balance: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{sim}\PY{o}{.}\PY{n}{balance}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
Final balance: 1073.4134501666726

    \end{Verbatim}

    \hypertarget{performance-analysis}{%
\section{Performance analysis}\label{performance-analysis}}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}19}]:} \PY{n}{analysis} \PY{o}{=} \PY{n}{bt}\PY{o}{.}\PY{n}{AnalyzeSim}\PY{p}{(}\PY{n}{sim}\PY{p}{)}
         
         \PY{n}{analysis}\PY{o}{.}\PY{n}{sim}\PY{o}{.}\PY{n}{df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{max\PYZus{}balance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{l+m+mi}{0}
         \PY{n}{analysis}\PY{o}{.}\PY{n}{sim}\PY{o}{.}\PY{n}{df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{max\PYZus{}balance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{analysis}\PY{o}{.}\PY{n}{sim}\PY{o}{.}\PY{n}{df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{balance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,} \PY{n+nb}{len}\PY{p}{(}\PY{n}{analysis}\PY{o}{.}\PY{n}{sim}\PY{o}{.}\PY{n}{df}\PY{o}{.}\PY{n}{index}\PY{p}{)}\PY{p}{)}\PY{p}{:}
             \PY{n}{analysis}\PY{o}{.}\PY{n}{sim}\PY{o}{.}\PY{n}{df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{max\PYZus{}balance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n+nb}{max}\PY{p}{(}\PY{n}{analysis}\PY{o}{.}\PY{n}{sim}\PY{o}{.}\PY{n}{df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{max\PYZus{}balance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{analysis}\PY{o}{.}\PY{n}{sim}\PY{o}{.}\PY{n}{df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{balance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
             
         \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
         \PY{n}{plot}\PY{p}{(}\PY{n}{analysis}\PY{o}{.}\PY{n}{sim}\PY{o}{.}\PY{n}{df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{balance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{lw}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
         \PY{n}{fill\PYZus{}between}\PY{p}{(}\PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{analysis}\PY{o}{.}\PY{n}{sim}\PY{o}{.}\PY{n}{df}\PY{o}{.}\PY{n}{index}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{analysis}\PY{o}{.}\PY{n}{sim}\PY{o}{.}\PY{n}{df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{balance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.25}\PY{p}{)}
         \PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Time in periods}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Equity}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Equity curve}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
         \PY{n}{grid}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_46_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}20}]:} \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{There are }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ trades}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{analysis}\PY{o}{.}\PY{n}{trades}\PY{p}{)}\PY{p}{)}\PY{p}{)}
         \PY{n}{good\PYZus{}trades} \PY{o}{=} \PY{n}{analysis}\PY{o}{.}\PY{n}{trades}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{analysis}\PY{o}{.}\PY{n}{trades}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pl}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{]}
         \PY{n}{bad\PYZus{}trades} \PY{o}{=} \PY{n}{analysis}\PY{o}{.}\PY{n}{trades}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{analysis}\PY{o}{.}\PY{n}{trades}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{pl}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZlt{}} \PY{l+m+mi}{0}\PY{p}{]}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Good trades: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{good\PYZus{}trades}\PY{p}{)}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Bad trades: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{bad\PYZus{}trades}\PY{p}{)}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Stopped trades: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{analysis}\PY{o}{.}\PY{n}{trades}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{analysis}\PY{o}{.}\PY{n}{trades}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{state}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stopped}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Win ratio is }\PY{l+s+si}{\PYZob{}:.2f\PYZcb{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{good\PYZus{}trades}\PY{p}{)}\PY{o}{/}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{good\PYZus{}trades}\PY{p}{)}\PY{o}{+}\PY{n+nb}{len}\PY{p}{(}\PY{n}{bad\PYZus{}trades}\PY{p}{)}\PY{p}{)}\PY{o}{*}\PY{l+m+mi}{100}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Leverage: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{use\PYZus{}leverage}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Stop loss percentage: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{optimal\PYZus{}stop\PYZus{}loss\PYZus{}percentage}\PY{p}{)}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Lot size: }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n}{optimal\PYZus{}lot\PYZus{}size}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
There are 1214 trades
Good trades: 350
Bad trades: 864
Stopped trades: 6
Win ratio is 28.83\%
Leverage: 1
Stop loss percentage: 0.08
Lot size: 0.3

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}21}]:} \PY{n}{analysis}\PY{o}{.}\PY{n}{roe}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}21}]:} 0.073413450166672556
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}22}]:} \PY{n}{analysis}\PY{o}{.}\PY{n}{paid\PYZus{}fees}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}22}]:} 279.07524542297313
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}23}]:} \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
         \PY{n}{drawdown} \PY{o}{=} \PY{n}{analysis}\PY{o}{.}\PY{n}{sim}\PY{o}{.}\PY{n}{df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{max\PYZus{}balance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{analysis}\PY{o}{.}\PY{n}{sim}\PY{o}{.}\PY{n}{df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{balance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
         \PY{n}{plot}\PY{p}{(}\PY{n}{drawdown}\PY{p}{,} \PY{n}{lw}\PY{o}{=}\PY{l+m+mi}{2}\PY{p}{)}
         \PY{n}{fill\PYZus{}between}\PY{p}{(}\PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{analysis}\PY{o}{.}\PY{n}{sim}\PY{o}{.}\PY{n}{df}\PY{o}{.}\PY{n}{index}\PY{p}{)}\PY{p}{)}\PY{p}{,} \PY{n}{drawdown}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.25}\PY{p}{)}
         \PY{n}{grid}\PY{p}{(}\PY{p}{)}
         \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
         \PY{n}{max\PYZus{}drawdown} \PY{o}{=} \PY{n+nb}{max}\PY{p}{(}\PY{n}{drawdown}\PY{p}{)}
         \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Max drawdown: }\PY{l+s+si}{\PYZob{}:.2f\PYZcb{}}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{l+m+mi}{1}\PY{o}{\PYZhy{}}\PY{n}{max\PYZus{}drawdown} \PY{o}{/} \PY{n}{analysis}\PY{o}{.}\PY{n}{sim}\PY{o}{.}\PY{n}{df}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{drawdown}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{drawdown} \PY{o}{==} \PY{n}{max\PYZus{}drawdown}\PY{p}{]}\PY{o}{.}\PY{n}{index}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{balance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}\PY{p}{)}
\end{Verbatim}


    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_50_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
Max drawdown: 0.07

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}24}]:} \PY{n}{analysis}\PY{o}{.}\PY{n}{trades}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}24}]:}        state position\_type  lot\_size\_base  lot\_size\_base\_leveraged  \textbackslash{}
         0     closed         short     300.000000               300.000000   
         1     closed          long     299.902828               299.902828   
         2     closed         short     299.812857               299.812857   
         3     closed          long     299.537369               299.537369   
         4     closed         short     299.447508               299.447508   
         5     closed          long     299.796336               299.796336   
         6     closed         short     299.449610               299.449610   
         7     closed          long     299.359775               299.359775   
         8     closed         short     298.182408               298.182408   
         9     closed          long     297.787970               297.787970   
         10    closed         short     297.698633               297.698633   
         11    closed          long     297.609324               297.609324   
         12    closed         short     297.520041               297.520041   
         13    closed          long     296.305147               296.305147   
         14    closed          long     295.713265               295.713265   
         15    closed         short     293.045529               293.045529   
         16    closed          long     293.331903               293.331903   
         17    closed         short     291.707563               291.707563   
         18    closed          long     289.107405               289.107405   
         19    closed         short     287.506457               287.506457   
         20    closed          long     287.420205               287.420205   
         21    closed         short     287.333979               287.333979   
         22    closed          long     287.247779               287.247779   
         23    closed         short     286.778806               286.778806   
         24    closed          long     286.692773               286.692773   
         25    closed         short     288.517094               288.517094   
         26    closed          long     288.430539               288.430539   
         27    closed         short     288.532844               288.532844   
         28    closed          long     288.446284               288.446284   
         29    closed         short     288.359750               288.359750   
         {\ldots}      {\ldots}           {\ldots}            {\ldots}                      {\ldots}   
         1184  closed          long     321.136750               321.136750   
         1185  closed         short     320.274665               320.274665   
         1186  closed          long     318.557594               318.557594   
         1187  closed         short     327.823674               327.823674   
         1188  closed          long     327.256911               327.256911   
         1189  closed         short     330.183121               330.183121   
         1190  closed          long     328.716117               328.716117   
         1191  closed         short     328.596103               328.596103   
         1192  closed          long     326.816342               326.816342   
         1193  closed         short     325.323178               325.323178   
         1194  closed          long     325.143470               325.143470   
         1195  closed         short     324.317572               324.317572   
         1196  closed          long     325.823501               325.823501   
         1197  closed         short     332.475594               332.475594   
         1198  closed          long     331.561177               331.561177   
         1199  closed         short     332.497330               332.497330   
         1200  closed          long     331.079097               331.079097   
         1201  closed          long     329.832155               329.832155   
         1202  closed          long     328.681639               328.681639   
         1203  closed          long     328.509831               328.509831   
         1204  closed         short     326.262025               326.262025   
         1205  closed          long     324.718153               324.718153   
         1206  closed         short     323.313630               323.313630   
         1207  closed          long     322.260210               322.260210   
         1208  closed         short     321.476100               321.476100   
         1209  closed          long     317.320382               317.320382   
         1210  closed         short     315.548626               315.548626   
         1211  closed          long     317.326999               317.326999   
         1212  closed         short     317.835087               317.835087   
         1213  closed          long     319.780900               319.780900   
         
               lot\_size\_quote  lot\_size\_quote\_leveraged  leverage  entry\_price  \textbackslash{}
         0           1.290284                  1.290284         1   232.506980   
         1           1.272629                  1.272629         1   235.656085   
         2           1.236342                  1.236342         1   242.500000   
         3           1.264287                  1.264287         1   236.922050   
         4           1.237386                  1.237386         1   242.000000   
         5           1.270323                  1.270323         1   236.000000   
         6           1.242530                  1.242530         1   241.000000   
         7           1.248276                  1.248276         1   239.818617   
         8           1.254448                  1.254448         1   237.700000   
         9           1.254218                  1.254218         1   237.429160   
         10          1.245601                  1.245601         1   239.000000   
         11          1.253860                  1.253860         1   237.354602   
         12          1.250084                  1.250084         1   238.000000   
         13          1.264496                  1.264496         1   234.326594   
         14          1.232241                  1.232241         1   239.979996   
         15          1.247002                  1.247002         1   235.000000   
         16          1.280925                  1.280925         1   229.000000   
         17          1.287892                  1.287892         1   226.500000   
         18          1.262478                  1.262478         1   229.000000   
         19          1.255487                  1.255487         1   229.000000   
         20          1.277423                  1.277423         1   225.000000   
         21          1.254734                  1.254734         1   229.000000   
         22          1.276657                  1.276657         1   225.000000   
         23          1.263343                  1.263343         1   227.000000   
         24          1.274190                  1.274190         1   225.000000   
         25          1.217372                  1.217372         1   237.000000   
         26          1.259522                  1.259522         1   229.000000   
         27          1.202225                  1.202225         1   239.999000   
         28          1.259591                  1.259591         1   229.000000   
         29          1.259213                  1.259213         1   229.000000   
         {\ldots}              {\ldots}                       {\ldots}       {\ldots}          {\ldots}   
         1184        0.040378                  0.040378         1  7953.246141   
         1185        0.040286                  0.040286         1  7950.000000   
         1186        0.039797                  0.039797         1  8004.497520   
         1187        0.036959                  0.036959         1  8869.940393   
         1188        0.036928                  0.036928         1  8862.000001   
         1189        0.036144                  0.036144         1  9135.134327   
         1190        0.035683                  0.035683         1  9212.000000   
         1191        0.035463                  0.035463         1  9265.857272   
         1192        0.034862                  0.034862         1  9374.459578   
         1193        0.034974                  0.034974         1  9301.727473   
         1194        0.034926                  0.034926         1  9309.549343   
         1195        0.035054                  0.035054         1  9251.813016   
         1196        0.036042                  0.036042         1  9040.020705   
         1197        0.034357                  0.034357         1  9677.000000   
         1198        0.034046                  0.034046         1  9738.555605   
         1199        0.033790                  0.033790         1  9840.000000   
         1200        0.033442                  0.033442         1  9900.000000   
         1201        0.035119                  0.035119         1  9391.758863   
         1202        0.035902                  0.035902         1  9155.000000   
         1203        0.038715                  0.038715         1  8485.235594   
         1204        0.038909                  0.038909         1  8385.209772   
         1205        0.038330                  0.038330         1  8471.752489   
         1206        0.038688                  0.038688         1  8356.936255   
         1207        0.038186                  0.038186         1  8439.300000   
         1208        0.038072                  0.038072         1  8444.000000   
         1209        0.036652                  0.036652         1  8657.550000   
         1210        0.037102                  0.037102         1  8505.000000   
         1211        0.038473                  0.038473         1  8248.000000   
         1212        0.038292                  0.038292         1  8300.295132   
         1213        0.039369                  0.039369         1  8122.700000   
         
                exit\_price  fee\_percentage stop\_loss  stop\_loss\_percentage  \textbackslash{}
         0      232.525500          0.0005     limit                  0.08   
         1      235.656085          0.0005     limit                  0.08   
         2      243.000000          0.0005     limit                  0.08   
         3      236.922050          0.0005     limit                  0.08   
         4      240.818900          0.0005     limit                  0.08   
         5      235.325854          0.0005     limit                  0.08   
         6      241.000000          0.0005     limit                  0.08   
         7      236.913000          0.0005     limit                  0.08   
         8      238.510000          0.0005     limit                  0.08   
         9      237.429160          0.0005     limit                  0.08   
         10     239.000000          0.0005     limit                  0.08   
         11     237.354602          0.0005     limit                  0.08   
         12     241.000000          0.0005     limit                  0.08   
         13     233.000000          0.0005     limit                  0.08   
         14     233.000000          0.0005     limit                  0.08   
         15     234.000000          0.0005     limit                  0.08   
         16     225.000004          0.0005     limit                  0.08   
         17     233.000000          0.0005     limit                  0.08   
         18     225.000000          0.0005     limit                  0.08   
         19     229.000000          0.0005     limit                  0.08   
         20     225.000000          0.0005     limit                  0.08   
         21     229.000000          0.0005     limit                  0.08   
         22     224.000017          0.0005     limit                  0.08   
         23     226.999998          0.0005     limit                  0.08   
         24     230.000000          0.0005     limit                  0.08   
         25     237.000000          0.0005     limit                  0.08   
         26     229.500000          0.0005     limit                  0.08   
         27     239.999000          0.0005     limit                  0.08   
         28     229.000000          0.0005     limit                  0.08   
         29     239.999000          0.0005     limit                  0.08   
         {\ldots}           {\ldots}             {\ldots}       {\ldots}                   {\ldots}   
         1184  7890.000000          0.0005     limit                  0.08   
         1185  8084.055923          0.0005     limit                  0.08   
         1186  8789.000000          0.0005     limit                  0.08   
         1187  8912.165818          0.0005     limit                  0.08   
         1188  9135.134327          0.0005     limit                  0.08   
         1189  9261.227492          0.0005     limit                  0.08   
         1190  9210.000000          0.0005     limit                  0.08   
         1191  9423.799996          0.0005     limit                  0.08   
         1192  9241.000000          0.0005     limit                  0.08   
         1193  9309.549343          0.0005     limit                  0.08   
         1194  9240.000000          0.0005     limit                  0.08   
         1195  9099.438496          0.0005     limit                  0.08   
         1196  9664.584036          0.0005     limit                  0.08   
         1197  9756.000000          0.0005     limit                  0.08   
         1198  9840.000000          0.0005     limit                  0.08   
         1199  9970.000000          0.0005     limit                  0.08   
         1200  9785.555000          0.0005     limit                  0.08   
         1201  9291.900000          0.0005     limit                  0.08   
         1202  9148.200000          0.0005     limit                  0.08   
         1203  8300.096056          0.0005     limit                  0.08   
         1204  8509.025318          0.0005     limit                  0.08   
         1205  8358.022700          0.0005     limit                  0.08   
         1206  8439.300000          0.0005     limit                  0.08   
         1207  8379.262151          0.0005     limit                  0.08   
         1208  8799.229999          0.0005     limit                  0.08   
         1209  8505.000000          0.0005     limit                  0.08   
         1210  8336.803816          0.0005     limit                  0.08   
         1211  8300.295132          0.0005     limit                  0.08   
         1212  8122.700000          0.0005     limit                  0.08   
         1213  8320.846764          0.0005     limit                  0.08   
         
               stop\_loss\_price  order\_cost  market\_value         pl  pl\_percent  \textbackslash{}
         0          251.107538  300.000000    300.023896  -0.323908    0.999920   
         1          216.803598  299.902828    299.902828  -0.299903    1.000000   
         2          261.900000  299.812857    300.431028  -0.918293    0.997942   
         3          217.968286  299.537369    299.537369  -0.299537    1.000000   
         4          261.360000  299.447508    297.986031   1.162760    1.004905   
         5          217.120000  299.796336    298.939952  -1.155752    0.997143   
         6          260.280000  299.449610    299.449610  -0.299450    1.000000   
         7          220.633128  299.359775    295.732763  -3.924558    0.987884   
         8          256.716000  298.182408    299.198511  -1.314794    0.996604   
         9          218.434827  297.787970    297.787970  -0.297788    1.000000   
         10         258.120000  297.698633    297.698633  -0.297699    1.000000   
         11         218.366234  297.609324    297.609324  -0.297609    1.000000   
         12         257.040000  297.520041    301.270294  -4.049648    0.987552   
         13         215.580466  296.305147    294.627673  -1.972940    0.994339   
         14         220.781596  295.713265    287.112225  -8.892452    0.970914   
         15         253.800000  293.045529    291.798527   0.954580    1.004274   
         16         210.680000  293.331903    288.208206  -5.414467    0.982533   
         17         244.620000  291.707563    300.078862  -8.667192    0.972103   
         18         210.680000  289.107405    284.057494  -5.336493    0.982533   
         19         247.320000  287.506457    287.506457  -0.287506    1.000000   
         20         207.000000  287.420205    287.420205  -0.287420    1.000000   
         21         247.320000  287.333979    287.333979  -0.287334    1.000000   
         22         207.000000  287.247779    285.971144  -1.563245    0.995556   
         23         245.160000  286.778806    286.778804  -0.286777    1.000000   
         24         207.000000  286.692773    293.063723   6.081072    1.022222   
         25         255.960000  288.517094    288.517094  -0.288517    1.000000   
         26         210.680000  288.430539    289.060300   0.341016    1.002183   
         27         259.198920  288.532844    288.532844  -0.288533    1.000000   
         28         210.680000  288.446284    288.446284  -0.288446    1.000000   
         29         247.320000  288.359750    302.209832 -14.145367    0.954171   
         {\ldots}               {\ldots}         {\ldots}           {\ldots}        {\ldots}         {\ldots}   
         1184      7316.986450  321.136750    318.582993  -2.873617    0.992048   
         1185      8586.000000  320.274665    325.675258  -5.723568    0.983417   
         1186      7364.137719  318.557594    349.778695  30.886933    1.098008   
         1187      9579.535624  327.823674    329.384282  -1.889211    0.995262   
         1188      8153.040001  327.256911    337.343245   9.754034    1.030821   
         1189      9865.945073  330.183121    334.740671  -4.890012    0.986385   
         1190      8475.040000  328.716117    328.644750  -0.400047    0.999783   
         1191     10007.125853  328.596103    334.197243  -5.932537    0.983240   
         1192      8624.502812  326.816342    322.163618  -4.977214    0.985763   
         1193     10045.865671  325.323178    325.596744  -0.599026    0.999160   
         1194      8564.785396  325.143470    322.714404  -2.752995    0.992529   
         1195      9991.958057  324.317572    318.976161   5.019764    1.016745   
         1196      8316.819048  325.823501    348.334225  22.173645    1.069089   
         1197     10451.160000  332.475594    335.189821  -3.048059    0.991902   
         1198      8959.471157  331.561177    335.014977   3.120512    1.010417   
         1199     10627.200000  332.497330    336.890079  -4.727443    0.986961   
         1200      9108.000000  331.079097    327.251789  -4.156473    0.988440   
         1201      8640.418154  329.832155    326.325180  -3.835054    0.989367   
         1202      8422.600000  328.681639    328.437506  -0.572692    0.999257   
         1203      7806.416746  328.509831    321.342068  -7.492689    0.978181   
         1204      9056.026554  326.262025    331.079592  -5.146238    0.985449   
         1205      7794.012290  324.718153    320.358946  -4.681746    0.986575   
         1206      9025.491155  323.313630    326.500123  -3.511400    0.990240   
         1207      7764.156000  322.260210    319.967625  -2.613699    0.992886   
         1208      9119.520000  321.476100    335.000254 -13.852392    0.959629   
         1209      7964.946000  317.320382    311.729052  -5.905855    0.982380   
         1210      9185.400000  315.548626    309.308288   5.927910    1.020175   
         1211      7588.160000  317.326999    319.338960   1.693628    1.006340   
         1212      8964.318743  317.835087    311.034610   6.486042    1.021864   
         1213      7472.884000  319.780900    327.581699   7.477118    1.024394   
         
               paid\_fees  
         0      0.300012  
         1      0.299903  
         2      0.300122  
         3      0.299537  
         4      0.298717  
         5      0.299368  
         6      0.299450  
         7      0.297546  
         8      0.298690  
         9      0.297788  
         10     0.297699  
         11     0.297609  
         12     0.299395  
         13     0.295466  
         14     0.291413  
         15     0.292422  
         16     0.290770  
         17     0.295893  
         18     0.286582  
         19     0.287506  
         20     0.287420  
         21     0.287334  
         22     0.286609  
         23     0.286779  
         24     0.289878  
         25     0.288517  
         26     0.288745  
         27     0.288533  
         28     0.288446  
         29     0.295285  
         {\ldots}         {\ldots}  
         1184   0.319860  
         1185   0.322975  
         1186   0.334168  
         1187   0.328604  
         1188   0.332300  
         1189   0.332462  
         1190   0.328680  
         1191   0.331397  
         1192   0.324490  
         1193   0.325460  
         1194   0.323929  
         1195   0.321647  
         1196   0.337079  
         1197   0.333833  
         1198   0.333288  
         1199   0.334694  
         1200   0.329165  
         1201   0.328079  
         1202   0.328560  
         1203   0.324926  
         1204   0.328671  
         1205   0.322539  
         1206   0.324907  
         1207   0.321114  
         1208   0.328238  
         1209   0.314525  
         1210   0.312428  
         1211   0.318333  
         1212   0.314435  
         1213   0.323681  
         
         [1214 rows x 18 columns]
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}25}]:} \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{There are }\PY{l+s+si}{\PYZob{}\PYZcb{}}\PY{l+s+s1}{ stopped trades.}\PY{l+s+s1}{\PYZsq{}}\PY{o}{.}\PY{n}{format}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{analysis}\PY{o}{.}\PY{n}{trades}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{analysis}\PY{o}{.}\PY{n}{trades}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{state}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stopped}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}\PY{p}{)}\PY{p}{)}
         \PY{n}{analysis}\PY{o}{.}\PY{n}{trades}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{analysis}\PY{o}{.}\PY{n}{trades}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{state}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{==} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{stopped}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
There are 6 stopped trades.

    \end{Verbatim}

\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}25}]:}         state position\_type  lot\_size\_base  lot\_size\_base\_leveraged  \textbackslash{}
         356   stopped         short     216.939823               216.939823   
         394   stopped         short     193.048484               193.048484   
         830   stopped          long     188.301559               188.301559   
         1105  stopped          long     363.031000               363.031000   
         1114  stopped          long     351.418307               351.418307   
         1179  stopped         short     333.038719               333.038719   
         
               lot\_size\_quote  lot\_size\_quote\_leveraged  leverage   entry\_price  \textbackslash{}
         356         0.611098                  0.611098         1    355.000000   
         394         0.501425                  0.501425         1    385.000000   
         830         0.157091                  0.157091         1   1198.681000   
         1105        0.025081                  0.025081         1  14474.177125   
         1114        0.029959                  0.029959         1  11730.000000   
         1179        0.047974                  0.047974         1   6942.048634   
         
                 exit\_price  fee\_percentage stop\_loss  stop\_loss\_percentage  \textbackslash{}
         356     383.400000          0.0005     limit                  0.08   
         394     415.800000          0.0005     limit                  0.08   
         830    1102.786520          0.0005     limit                  0.08   
         1105  13316.242955          0.0005     limit                  0.08   
         1114  10791.600000          0.0005     limit                  0.08   
         1179   7497.412525          0.0005     limit                  0.08   
         
               stop\_loss\_price  order\_cost  market\_value         pl  pl\_percent  \textbackslash{}
         356        383.400000  216.939823    234.295009 -17.580803    0.925926   
         394        415.800000  193.048484    208.492363 -15.644649    0.925926   
         830       1102.786520  188.301559    173.237434 -15.244894    0.920000   
         1105     13316.242955  363.031000    333.988520 -29.390990    0.920000   
         1114     10791.600000  351.418307    323.304842 -28.450826    0.920000   
         1179      7497.412525  333.038719    359.681817 -26.989458    0.925926   
         
               paid\_fees  
         356    0.225617  
         394    0.200770  
         830    0.180769  
         1105   0.348510  
         1114   0.337362  
         1179   0.346360  
\end{Verbatim}
            
    \hypertarget{fibonacci-levels}{%
\section{Fibonacci levels}\label{fibonacci-levels}}

    We can use this to calculate the Fibonacci level between two points.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}26}]:} \PY{n}{a} \PY{o}{=} \PY{l+m+mi}{9174} \PY{c+c1}{\PYZsh{} crossover price EMA55}
         \PY{n}{b} \PY{o}{=} \PY{l+m+mi}{8135} \PY{c+c1}{\PYZsh{} high of crossover candle if long, low of crossover if short}
         \PY{n}{r} \PY{o}{=} \PY{n}{a}\PY{o}{\PYZhy{}}\PY{n}{b}
         \PY{n}{f5} \PY{o}{=} \PY{n}{a}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{o}{*}\PY{l+m+mf}{0.5}
         \PY{n}{f618} \PY{o}{=} \PY{n}{a}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{o}{*}\PY{l+m+mf}{0.618}
         \PY{n}{f702} \PY{o}{=} \PY{n}{a}\PY{o}{\PYZhy{}}\PY{n}{r}\PY{o}{*}\PY{l+m+mf}{0.702}
         \PY{n}{f702}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}26}]:} 8444.622
\end{Verbatim}
            
    Actually it can be done for any level.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}27}]:} \PY{k}{def} \PY{n+nf}{getFib}\PY{p}{(}\PY{n}{crossover\PYZus{}price}\PY{p}{,} \PY{n}{candle\PYZus{}high\PYZus{}low}\PY{p}{,} \PY{n}{lvl}\PY{p}{)}\PY{p}{:} \PY{k}{return} \PY{n}{crossover\PYZus{}price}\PY{o}{\PYZhy{}}\PY{p}{(}\PY{n}{crossover\PYZus{}price}\PY{o}{\PYZhy{}}\PY{n}{candle\PYZus{}high\PYZus{}low}\PY{p}{)}\PY{o}{*}\PY{n}{lvl}
\end{Verbatim}


    We are using \texttt{0.702} which is a mid-level.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}28}]:} \PY{n}{getFib}\PY{p}{(}\PY{l+m+mi}{9174}\PY{p}{,} \PY{l+m+mi}{8135}\PY{p}{,} \PY{o}{.}\PY{l+m+mi}{702}\PY{p}{)} \PY{c+c1}{\PYZsh{} Long}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}28}]:} 8444.622
\end{Verbatim}
            
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}29}]:} \PY{n}{getFib}\PY{p}{(}\PY{l+m+mi}{8135}\PY{p}{,} \PY{l+m+mi}{9174}\PY{p}{,} \PY{o}{.}\PY{l+m+mi}{702}\PY{p}{)} \PY{c+c1}{\PYZsh{} Short}
\end{Verbatim}


\begin{Verbatim}[commandchars=\\\{\}]
{\color{outcolor}Out[{\color{outcolor}29}]:} 8864.378
\end{Verbatim}
            
    Generating the Fibonacci sequence.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}30}]:} \PY{k}{def} \PY{n+nf}{fibo}\PY{p}{(}\PY{n}{n}\PY{p}{)}\PY{p}{:}
             \PY{n}{a} \PY{o}{=} \PY{l+m+mi}{1}
             \PY{n}{b} \PY{o}{=} \PY{l+m+mi}{1}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{n+nb}{print}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}
             \PY{k}{for} \PY{n}{\PYZus{}} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{n}\PY{p}{)}\PY{p}{:}
                 \PY{n}{c}\PY{o}{=}\PY{n}{a}\PY{o}{+}\PY{n}{b}
                 \PY{n}{a}\PY{o}{=}\PY{n}{b}
                 \PY{n}{b}\PY{o}{=}\PY{n}{c}
                 \PY{k}{yield} \PY{n}{c}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}31}]:} \PY{k}{for} \PY{n}{n} \PY{o+ow}{in} \PY{n}{fibo}\PY{p}{(}\PY{l+m+mi}{25}\PY{p}{)}\PY{p}{:} \PY{n+nb}{print}\PY{p}{(}\PY{n}{n}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
1
1
2
3
5
8
13
21
34
55
89
144
233
377
610
987
1597
2584
4181
6765
10946
17711
28657
46368
75025
121393
196418

    \end{Verbatim}


    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
